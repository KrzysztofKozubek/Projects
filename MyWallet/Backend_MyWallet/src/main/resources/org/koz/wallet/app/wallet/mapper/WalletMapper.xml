<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.koz.wallet.app.wallet.mapper.WalletMapper">

    <resultMap id="WalletMap" type="org.koz.wallet.app.wallet.model.Wallet">
        <result column="id" property="id"/>
        <result column="user_id" property="userId"/>
        <result column="name" property="name"/>
        <result column="amount_of_money" property="amount"/>
    </resultMap>

    <sql id="CONDITION_OWNER_USER">
        wallet.id = #{wallet.id} and wallet.user_id = #{wallet.userId}
    </sql>

    <insert id="addWallet">
        INSERT INTO wallet (user_id, name, amount_of_money)
        VALUES (#{wallet.userId}, #{wallet.name}, #{wallet.amount})
    </insert>

    <update id="editWallet">
        UPDATE wallet
        SET name            = #{wallet.name}
          , amount_of_money = #{wallet.amount}
        WHERE <include refid="CONDITION_OWNER_USER"/>;
    </update>

    <update id="editWalletName">
        UPDATE wallet
        SET name = #{wallet.name}
        WHERE <include refid="CONDITION_OWNER_USER"/>;
    </update>

    <update id="editWalletAmount">
        UPDATE wallet
        SET amount_of_money = #{wallet.amount}
        WHERE <include refid="CONDITION_OWNER_USER"/>;
    </update>

    <update id="registerTransaction">
        UPDATE wallet
        SET amount_of_money = amount_of_money + #{transaction.amount}
        WHERE wallet.id = #{transaction.walletId} and wallet.user_id = #{transaction.userId}
    </update>

    <delete id="removeWallet">
        DELETE
        FROM wallet
        WHERE wallet.id = #{walletId} and wallet.user_id = #{userId};
    </delete>

    <select id="getUserWallets" resultMap="WalletMap">
        SELECT id
             , user_id
             , name
             , amount_of_money
        FROM wallet
        WHERE wallet.user_id = #{userId}
    </select>

    <select id="getWallet" resultMap="WalletMap">
        SELECT id
             , user_id
             , name
             , amount_of_money
        FROM wallet
        WHERE wallet.id = #{walletId} and wallet.user_id = #{userId}
    </select>
</mapper>